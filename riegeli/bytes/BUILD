load("@bazel_skylib//rules:common_settings.bzl", "bool_flag")

package(
    default_visibility = ["//visibility:public"],
    features = ["header_modules"],
)

licenses(["notice"])

bool_flag(
    name = "use_copy_file_range",
    build_setting_default = True,
)

config_setting(
    name = "disable_copy_file_range",
    flag_values = {":use_copy_file_range": "False"},
)

cc_library(
    name = "reader",
    hdrs = ["reader.h"],
    deps = [
        ":reader_and_writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:chain",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/functional:function_ref",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "writer",
    hdrs = ["writer.h"],
    deps = [
        ":reader_and_writer",
        ":stringify",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:bytes_ref",
        "//riegeli/base:chain",
        "//riegeli/base:external_ref",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:reset",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/numeric:int128",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "backward_writer",
    hdrs = ["backward_writer.h"],
    deps = [
        ":reader_and_writer",
        ":stringify",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:bytes_ref",
        "//riegeli/base:chain",
        "//riegeli/base:external_ref",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/numeric:int128",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "reader_and_writer",
    srcs = [
        "backward_writer.cc",
        "reader.cc",
        "restricted_chain_writer.cc",
        "writer.cc",
    ],
    hdrs = [
        "backward_writer.h",
        "reader.h",
        "restricted_chain_writer.h",
        "writer.h",
    ],
    visibility = ["//visibility:private"],
    deps = [
        ":stringify",
        ":write_int_internal",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:bytes_ref",
        "//riegeli/base:chain",
        "//riegeli/base:cord_utils",
        "//riegeli/base:external_ref",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:reset",
        "//riegeli/base:status",
        "//riegeli/base:string_utils",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/functional:function_ref",
        "@com_google_absl//absl/numeric:int128",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
        "@com_google_absl//absl/strings:str_format",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "read_all",
    srcs = ["read_all.cc"],
    hdrs = ["read_all.h"],
    deps = [
        ":reader",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "copy_all",
    srcs = ["copy_all.cc"],
    hdrs = ["copy_all.h"],
    deps = [
        ":backward_writer",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "write",
    hdrs = ["write.h"],
    deps = [
        ":backward_writer",
        ":stringify",
        ":writer",
        "//riegeli/base:dependency",
        "//riegeli/base:type_traits",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
    ],
)

cc_library(
    name = "write_int_internal",
    srcs = ["write_int_internal.cc"],
    hdrs = ["write_int_internal.h"],
    visibility = ["//riegeli:__subpackages__"],
    deps = [
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/numeric:bits",
        "@com_google_absl//absl/numeric:int128",
    ],
)

cc_library(
    name = "stringify",
    hdrs = ["stringify.h"],
    deps = [
        ":write_int_internal",
        "//riegeli/base:byte_fill",
        "//riegeli/base:bytes_ref",
        "//riegeli/base:chain",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/numeric:int128",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "pullable_reader",
    srcs = ["pullable_reader.cc"],
    hdrs = ["pullable_reader.h"],
    deps = [
        ":backward_writer",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:chain",
        "//riegeli/base:cord_utils",
        "//riegeli/base:external_ref",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:sized_shared_buffer",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/functional:function_ref",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "pushable_writer",
    srcs = ["pushable_writer.cc"],
    hdrs = ["pushable_writer.h"],
    deps = [
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:cord_utils",
        "//riegeli/base:external_ref",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:sized_shared_buffer",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "pushable_backward_writer",
    srcs = ["pushable_backward_writer.cc"],
    hdrs = ["pushable_backward_writer.h"],
    deps = [
        ":backward_writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:cord_utils",
        "//riegeli/base:external_ref",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:sized_shared_buffer",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "buffer_options",
    srcs = ["buffer_options.cc"],
    hdrs = ["buffer_options.h"],
    deps = [
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/numeric:bits",
    ],
)

cc_library(
    name = "buffered_reader",
    srcs = ["buffered_reader.cc"],
    hdrs = ["buffered_reader.h"],
    deps = [
        ":backward_writer",
        ":buffer_options",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:chain",
        "//riegeli/base:external_ref",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:sized_shared_buffer",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/functional:function_ref",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "buffered_writer",
    srcs = ["buffered_writer.cc"],
    hdrs = ["buffered_writer.h"],
    deps = [
        ":buffer_options",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffer",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "wrapping_reader",
    srcs = ["wrapping_reader.cc"],
    hdrs = ["wrapping_reader.h"],
    deps = [
        ":backward_writer",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/functional:function_ref",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "wrapping_writer",
    srcs = ["wrapping_writer.cc"],
    hdrs = ["wrapping_writer.h"],
    deps = [
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "wrapping_backward_writer",
    srcs = ["wrapping_backward_writer.cc"],
    hdrs = ["wrapping_backward_writer.h"],
    deps = [
        ":backward_writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "limiting_reader",
    srcs = ["limiting_reader.cc"],
    hdrs = ["limiting_reader.h"],
    deps = [
        ":backward_writer",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/functional:function_ref",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "limiting_writer",
    srcs = ["limiting_writer.cc"],
    hdrs = ["limiting_writer.h"],
    deps = [
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "limiting_backward_writer",
    srcs = ["limiting_backward_writer.cc"],
    hdrs = ["limiting_backward_writer.h"],
    deps = [
        ":backward_writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "prefix_limiting_reader",
    srcs = ["prefix_limiting_reader.cc"],
    hdrs = ["prefix_limiting_reader.h"],
    deps = [
        ":backward_writer",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/functional:function_ref",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "prefix_limiting_writer",
    srcs = ["prefix_limiting_writer.cc"],
    hdrs = ["prefix_limiting_writer.h"],
    deps = [
        ":prefix_limiting_reader",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "prefix_limiting_backward_writer",
    srcs = ["prefix_limiting_backward_writer.cc"],
    hdrs = ["prefix_limiting_backward_writer.h"],
    deps = [
        ":backward_writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "position_shifting_reader",
    srcs = ["position_shifting_reader.cc"],
    hdrs = ["position_shifting_reader.h"],
    deps = [
        ":backward_writer",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/functional:function_ref",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "position_shifting_writer",
    srcs = ["position_shifting_writer.cc"],
    hdrs = ["position_shifting_writer.h"],
    deps = [
        ":position_shifting_reader",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "position_shifting_backward_writer",
    srcs = ["position_shifting_backward_writer.cc"],
    hdrs = ["position_shifting_backward_writer.h"],
    deps = [
        ":backward_writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "null_writer",
    srcs = ["null_writer.cc"],
    hdrs = ["null_writer.h"],
    deps = [
        ":buffer_options",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffer",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:external_ref",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "null_backward_writer",
    srcs = ["null_backward_writer.cc"],
    hdrs = ["null_backward_writer.h"],
    deps = [
        ":backward_writer",
        ":buffer_options",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffer",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:external_ref",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "joining_reader",
    srcs = ["joining_reader.cc"],
    hdrs = ["joining_reader.h"],
    deps = [
        ":pullable_reader",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:chain",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/functional:function_ref",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "splitting_writer",
    srcs = ["splitting_writer.cc"],
    hdrs = ["splitting_writer.h"],
    deps = [
        ":chain_reader",
        ":cord_reader",
        ":pushable_writer",
        ":string_reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "reader_factory",
    srcs = ["reader_factory.cc"],
    hdrs = ["reader_factory.h"],
    deps = [
        ":buffer_options",
        ":pullable_reader",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:stable_dependency",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/functional:function_ref",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
        "@com_google_absl//absl/synchronization",
    ],
)

cc_library(
    name = "array_writer",
    srcs = ["array_writer.cc"],
    hdrs = ["array_writer.h"],
    deps = [
        ":pushable_writer",
        ":reader",
        ":string_reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "array_backward_writer",
    srcs = ["array_backward_writer.cc"],
    hdrs = ["array_backward_writer.h"],
    deps = [
        ":backward_writer",
        ":pushable_backward_writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "string_reader",
    srcs = ["string_reader.cc"],
    hdrs = ["string_reader.h"],
    deps = [
        ":reader",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "string_writer",
    srcs = ["string_writer.cc"],
    hdrs = ["string_writer.h"],
    deps = [
        ":buffer_options",
        ":reader",
        ":string_reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:cord_utils",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "resizable_writer",
    srcs = ["resizable_writer.cc"],
    hdrs = ["resizable_writer.h"],
    deps = [
        ":buffer_options",
        ":reader",
        ":string_reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:cord_utils",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "compact_string_writer",
    hdrs = ["compact_string_writer.h"],
    deps = [
        ":resizable_writer",
        "//riegeli/base:assert",
        "//riegeli/base:compact_string",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:object",
    ],
)

cc_library(
    name = "chain_reader",
    srcs = ["chain_reader.cc"],
    hdrs = ["chain_reader.h"],
    deps = [
        ":backward_writer",
        ":pullable_reader",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "chain_writer",
    srcs = ["chain_writer.cc"],
    hdrs = ["chain_writer.h"],
    deps = [
        ":chain_reader",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "chain_backward_writer",
    srcs = ["chain_backward_writer.cc"],
    hdrs = ["chain_backward_writer.h"],
    deps = [
        ":backward_writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
        "@com_google_absl//absl/types:span",
    ],
)

cc_library(
    name = "restricted_chain_writer",
    hdrs = ["restricted_chain_writer.h"],
    deps = [
        ":reader_and_writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:external_ref",
        "//riegeli/base:object",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "cord_reader",
    srcs = ["cord_reader.cc"],
    hdrs = ["cord_reader.h"],
    deps = [
        ":backward_writer",
        ":pullable_reader",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "cord_writer",
    srcs = ["cord_writer.cc"],
    hdrs = ["cord_writer.h"],
    deps = [
        ":cord_reader",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffer",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:cord_utils",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "cord_backward_writer",
    srcs = ["cord_backward_writer.cc"],
    hdrs = ["cord_backward_writer.h"],
    deps = [
        ":backward_writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffer",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:chain",
        "//riegeli/base:cord_utils",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
        "@com_google_absl//absl/strings:cord",
    ],
)

cc_library(
    name = "file_mode_string",
    srcs = ["file_mode_string.cc"],
    hdrs = ["file_mode_string.h"],
    visibility = ["//visibility:private"],
    deps = [
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "path_ref",
    hdrs = ["path_ref.h"],
    deps = [
        "//riegeli/base:compare",
        "//riegeli/base:initializer",
        "//riegeli/base:string_ref",
        "//riegeli/base:type_traits",
        "@com_google_absl//absl/base:config",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "fd_handle",
    srcs = ["fd_handle.cc"],
    hdrs = ["fd_handle.h"],
    # fd_handle.cc has #define before #include to influence what the included
    # files provide.
    features = ["-use_header_modules"],
    deps = [
        ":fd_internal",
        ":path_ref",
        "//riegeli/base:any",
        "//riegeli/base:compare",
        "//riegeli/base:initializer",
        "//riegeli/base:reset",
        "//riegeli/base:shared_ptr",
        "//riegeli/base:status",
        "//riegeli/base:type_erased_ref",
        "//riegeli/base:type_traits",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/base:nullability",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ] + select({
        "@platforms//os:windows": [
            "//riegeli/base:unicode",
        ],
        "//conditions:default": [],
    }),
)

cc_library(
    name = "fd_reader",
    srcs = ["fd_reader.cc"] + select({
        "@platforms//os:windows": [],
        "//conditions:default": ["fd_writer.h"],
    }),
    hdrs = ["fd_reader.h"],
    defines = select({
        "//riegeli/bytes:disable_copy_file_range": ["RIEGELI_DISABLE_COPY_FILE_RANGE"],
        "//conditions:default": [],
    }),
    # fd_reader.cc has #define before #include to influence what the included
    # files provide.
    features = ["-use_header_modules"],
    deps = [
        ":buffer_options",
        ":buffered_reader",
        ":fd_handle",
        ":fd_internal",
        ":path_ref",
        ":reader",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:byte_fill",
        "//riegeli/base:dependency",
        "//riegeli/base:global",
        "//riegeli/base:initializer",
        "//riegeli/base:object",
        "//riegeli/base:reset",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/numeric:bits",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ] + select({
        "@platforms//os:windows": [],
        "//conditions:default": [
            ":buffered_writer",
            ":writer",
            "//riegeli/base:type_id",
        ],
    }),
)

cc_library(
    name = "fd_mmap_reader",
    srcs = ["fd_mmap_reader.cc"],
    hdrs = ["fd_mmap_reader.h"],
    # fd_mmap_reader.cc has #define before #include to influence what the
    # included files provide.
    features = ["-use_header_modules"],
    deps = [
        ":chain_reader",
        ":fd_handle",
        ":fd_internal",
        ":path_ref",
        ":reader",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:chain",
        "//riegeli/base:dependency",
        "//riegeli/base:external_ref",
        "//riegeli/base:initializer",
        "//riegeli/base:object",
        "//riegeli/base:reset",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ] + select({
        "@platforms//os:windows": [],
        "//conditions:default": [
            "//riegeli/base:global",
            "@com_google_absl//absl/status:statusor",
        ],
    }),
)

cc_library(
    name = "fd_writer",
    srcs = ["fd_writer.cc"],
    hdrs = ["fd_writer.h"],
    # fd_writer.cc has #define before #include to influence what the included
    # files provide.
    features = ["-use_header_modules"],
    deps = [
        ":buffer_options",
        ":buffered_writer",
        ":fd_handle",
        ":fd_internal",
        ":fd_reader",
        ":path_ref",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:buffering",
        "//riegeli/base:byte_fill",
        "//riegeli/base:dependency",
        "//riegeli/base:global",
        "//riegeli/base:initializer",
        "//riegeli/base:object",
        "//riegeli/base:reset",
        "//riegeli/base:status",
        "//riegeli/base:type_id",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/numeric:bits",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "fd_internal",
    srcs = ["fd_internal.cc"],
    hdrs = [
        "fd_internal.h",
        "fd_internal_for_cc.h",
    ],
    # fd_internal.cc has #define before #include to influence what the included
    # files provide.
    features = ["-use_header_modules"],
    visibility = ["//visibility:private"],
    deps = ["@com_google_absl//absl/strings"] + select({
        "@platforms//os:windows": [],
        "//conditions:default": [
            "//riegeli/base:arithmetic",
            "//riegeli/base:buffer",
            "@com_google_absl//absl/base:core_headers",
        ],
    }),
)

cc_library(
    name = "std_io",
    srcs = ["std_io.cc"],
    hdrs = ["std_io.h"],
    deps = [
        ":fd_handle",
        ":fd_reader",
        ":fd_writer",
        "//riegeli/base:assert",
        "//riegeli/base:global",
        "//riegeli/base:object",
        "//riegeli/base:sized_shared_buffer",
        "@com_google_absl//absl/base:core_headers",
    ],
)

cc_library(
    name = "istream_reader",
    srcs = [
        "iostream_internal.h",
        "istream_reader.cc",
    ],
    hdrs = ["istream_reader.h"],
    deps = [
        ":buffer_options",
        ":buffered_reader",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:global",
        "//riegeli/base:initializer",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "ostream_writer",
    srcs = [
        "iostream_internal.h",
        "ostream_writer.cc",
    ],
    hdrs = ["ostream_writer.h"],
    deps = [
        ":buffer_options",
        ":buffered_writer",
        ":istream_reader",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:global",
        "//riegeli/base:initializer",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "reader_istream",
    srcs = ["reader_istream.cc"],
    hdrs = ["reader_istream.h"],
    deps = [
        ":reader",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
    ],
)

cc_library(
    name = "writer_ostream",
    srcs = ["writer_ostream.cc"],
    hdrs = ["writer_ostream.h"],
    deps = [
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:moving_dependency",
        "//riegeli/base:null_safe_memcpy",
        "//riegeli/base:object",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "cfile_handle",
    srcs = ["cfile_handle.cc"],
    hdrs = ["cfile_handle.h"],
    # cfile_handle.cc has #define before #include to influence what the
    # included files provide.
    features = ["-use_header_modules"],
    deps = [
        ":cfile_internal",
        ":path_ref",
        "//riegeli/base:any",
        "//riegeli/base:c_string_ref",
        "//riegeli/base:compare",
        "//riegeli/base:initializer",
        "//riegeli/base:reset",
        "//riegeli/base:shared_ptr",
        "//riegeli/base:status",
        "//riegeli/base:type_erased_ref",
        "//riegeli/base:type_traits",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/base:nullability",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ] + select({
        "@platforms//os:windows": [
            "//riegeli/base:unicode",
        ],
        "//conditions:default": [],
    }),
)

cc_library(
    name = "cfile_reader",
    srcs = ["cfile_reader.cc"],
    hdrs = ["cfile_reader.h"],
    features = select({
        "@platforms//os:windows": [],
        # cfile_reader.cc has #define before #include to influence what the
        # included files provide.
        "//conditions:default": ["-use_header_modules"],
    }),
    deps = [
        ":buffer_options",
        ":buffered_reader",
        ":cfile_handle",
        ":cfile_internal",
        ":file_mode_string",
        ":path_ref",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:global",
        "//riegeli/base:initializer",
        "//riegeli/base:object",
        "//riegeli/base:reset",
        "//riegeli/base:status",
        "//riegeli/base:string_ref",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/base:dynamic_annotations",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "cfile_writer",
    srcs = ["cfile_writer.cc"],
    hdrs = ["cfile_writer.h"],
    features = select({
        "@platforms//os:windows": [],
        # cfile_writer.cc has #define before #include to influence what the
        # included files provide.
        "//conditions:default": ["-use_header_modules"],
    }),
    deps = [
        ":buffer_options",
        ":buffered_writer",
        ":cfile_handle",
        ":cfile_internal",
        ":cfile_reader",
        ":file_mode_string",
        ":path_ref",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:global",
        "//riegeli/base:initializer",
        "//riegeli/base:object",
        "//riegeli/base:reset",
        "//riegeli/base:status",
        "//riegeli/base:string_ref",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "cfile_internal",
    srcs = ["cfile_internal.cc"],
    hdrs = [
        "cfile_internal.h",
        "cfile_internal_for_cc.h",
    ],
    visibility = ["//visibility:private"],
    deps = [
        ":fd_internal",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "reader_cfile",
    srcs = ["reader_cfile.cc"],
    hdrs = ["reader_cfile.h"],
    # reader_cfile.cc has #define before #include to influence what the included
    # files provide.
    features = ["-use_header_modules"],
    deps = [
        ":cfile_handle",
        ":path_ref",
        ":reader",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:reset",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/status",
    ],
)

cc_library(
    name = "writer_cfile",
    srcs = [
        "writer_cfile.cc",
    ],
    hdrs = ["writer_cfile.h"],
    # writer_cfile.cc has #define before #include to influence what the included
    # files provide.
    features = ["-use_header_modules"],
    deps = [
        ":cfile_handle",
        ":path_ref",
        ":reader",
        ":writer",
        "//riegeli/base:arithmetic",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:initializer",
        "//riegeli/base:reset",
        "//riegeli/base:status",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/base:dynamic_annotations",
        "@com_google_absl//absl/status",
        "@com_google_absl//absl/strings",
    ],
)

cc_library(
    name = "stringify_writer",
    hdrs = ["stringify_writer.h"],
    deps = [
        ":buffered_writer",
        ":prefix_limiting_writer",
        ":writer",
        "//riegeli/base:assert",
        "//riegeli/base:dependency",
        "//riegeli/base:object",
        "//riegeli/base:reset",
        "//riegeli/base:types",
        "@com_google_absl//absl/base:core_headers",
        "@com_google_absl//absl/strings",
    ],
)
